<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>Rain Sugar BangBang Front-End</title><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Entityrepository()를 대신한 Repository 생성"/><meta name="keywords" content="nestjs, nestjs-nestjs custom repository"/><meta http-equiv="subject" content="nestjs"/><meta property="og:title" content="nestjs custom repository"/><meta property="og:description" content="Entityrepository()를 대신한 Repository 생성"/><meta property="og:image" content="../images/NESTJS.png"/><meta name="naver-site-verification" content="af9c8049662a7c6c85ea946e9eb561086e70062c"/><meta name="google-site-verification" content="Zgp7rA3RAdcRnhPPsGLK-t4KVTO86AejlDIQQIGpvLg"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4077287316160146" crossorigin="anonymous"></script><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/b4f97ab2e5eec96e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b4f97ab2e5eec96e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f164db4954bac6ec.js" defer=""></script><script src="/_next/static/chunks/framework-73b8966a3c579ab0.js" defer=""></script><script src="/_next/static/chunks/main-b0c8bcfd40968c52.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0613093c3b45bf1f.js" defer=""></script><script src="/_next/static/chunks/572-f075c46b792eab08.js" defer=""></script><script src="/_next/static/chunks/pages/nestjs/%5Bslug%5D-cd7fa6cb328ae5b7.js" defer=""></script><script src="/_next/static/9g1QMk00T1BReQcEHL4r_/_buildManifest.js" defer=""></script><script src="/_next/static/9g1QMk00T1BReQcEHL4r_/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="sc-fc886cc0-0 bZSIAs"><h1>Rain Sugar BangBang</h1></header><div class="sc-ba37e1ab-0 jsuXVA"><section class="sc-ba37e1ab-1 flRwaC"><aside class="sc-66bc730f-0 khiCBg"><div class="sc-66bc730f-1 IEUha"><img alt="profile" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" style="color:transparent" src="https://avatars.githubusercontent.com/u/85297720?v=4"/><p>Hanbbi</p></div><div class="sc-66bc730f-2 irHvHG"><a target="_blank" href="https://github.com/LEE-YO-HAN"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg><span>yhl0078@gmail.com</span></a><a target="_blank" href="https://github.com/LEE-YO-HAN"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg><span>Github</span></a></div></aside><article class="sc-ba37e1ab-2 kOvCyN"><main class="sc-11af7490-0 cFrzTj"><section class="sc-11af7490-1 cfbImy"><p>nestjs</p><h1>Entityrepository()를 대신한 Repository 생성</h1><span>2023-03-04</span></section><main class="sc-11af7490-2 gtQrim"><div class="markdown"><h2>포스팅 시점 nestjs 버전 : 9.x.x</h2>
<p>새로운 토이 프로젝트를 만들면서 백엔드를 구축할 프레임워크로 nestjs를 이용하기로 마음먹었다.</p>
<p>원래 사용하고 있던 javascript/typescript와 동일한 언어를 사용하기 때문에 백엔드 구축에 비교적 진입장벽이 낮다고 생각했기 때문에다.</p>
<h1>nest 작동순서</h1>
<p>request -&gt; controller -&gt; service -&gt; controller -&gt; response 순으로 작동하나, DB와 관련된 일을 시키기 위해서는 repository를 생성해야한다고 한다. 즉,</p>
<p>request -&gt; controller -&gt; service -&gt; repo* -&gt; service -&gt; controller -&gt; response
로 한 단계가 추가된다. (Repostitory pattern)</p>
<p>@EntityRepository를 통해 레포지토리를 설정해주는 방식이 많이 보였지만</p>
<p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FlkldE%2FbtrUQbTjKZA%2FA6hFzyRy8SsueBbUk8cTA1%2Fimg.png" alt="image"/></p>
<p>현재 버전에서는 사용할 수 없어 다른 방법을 알아봤다.</p>
<h2>기본 설정</h2>
<p>config 설정</p>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-typescript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// src/configs/typeorm.configs.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">const</span><span> typeORMConfig</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">TypeOrmModuleOptions</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#808080">// Database Type</span><span>
</span><span>  type</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;postgres&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#808080">// 본인은 pg를 사용</span><span>
</span><span>  host</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;localhost&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  port</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6897bb">5432</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  username</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;postgres&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  password</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;password&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  database</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;database&quot;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  entities</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>__dirname </span><span class="token" style="color:#a9b7c6">+</span><span> </span><span class="token" style="color:#6a8759">&quot;/../**/*.entity.{js,ts}&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#808080">// 해당 경로 + 엔티티이름.entity.{js.ts}로 된 엔티티를 이용</span><span>
</span><span>  </span><span class="token" style="color:#808080">// autoLoadEntities: true, // 위와 다르게 entity들 알아서 찾아줌</span><span>
</span><span>  synchronize</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">true</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#808080">// @@@@@@@@ 배포할때 true 사용 시 데이터 삭제될 수 있음. production 단계에서는 필히 false로 해줄 것 권장 @@@@@@</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span></code></pre></pre>
<p>config 설정 후 root 모듈에 import</p>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-typescript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// app.module.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Module</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/common&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">AppController</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./app.controller&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PostlistModule</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./postlist/postlist.module&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> typeORMConfig </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./configs/typeorm.configs&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">TypeOrmModule</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/typeorm/dist&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Module</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  imports</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token maybe-class-name">TypeOrmModule</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">forRoot</span><span class="token" style="color:#a9b7c6">(</span><span>typeORMConfig</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token maybe-class-name">PostlistModule</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  controllers</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token maybe-class-name">AppController</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  providers</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">class</span><span> </span><span class="token class-name maybe-class-name">AppModule</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span></code></pre></pre>
<p>entity 생성</p>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-typescript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// src/postlist/entities/postlist.entity.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">BaseEntity</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Column</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">PrimaryGeneratedColumn</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Entity</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;typeorm&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Entity</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">class</span><span> </span><span class="token class-name maybe-class-name">Postlist</span><span> </span><span class="token" style="color:#cc7832">extends</span><span> </span><span class="token class-name maybe-class-name">BaseEntity</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">PrimaryGeneratedColumn</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  id</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Column</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  title</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">string</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Column</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  content</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">string</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Column</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  nickname</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">string</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Column</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  imageUrl</span><span class="token" style="color:#a9b7c6">?</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">string</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></pre></pre>
<blockquote>
<p>config 설정 시 entities에 이름을 ~~.entity.{js.ts} 로 설정해놓고, 정작 entity 파일 이름을 설정한 형식과 다르게 작성하면 [EntityMetadataNotFound] 에러를 띄우게 되기 때문에 설정한대로 이름을 지어줘야 한다.</p>
</blockquote>
<p>참조 : <a href="https://github.com/typeorm/typeorm/issues/1327">https://github.com/typeorm/typeorm/issues/1327</a></p>
<h2>custumRepository 만들기</h2>
<p>본인은 src에 database 디렉토리를 만들어, 데코레이터와 모듈을 그 안에 넣어줬다.</p>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-typescript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// src/database/typeorm-ex.decorator.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">SetMetadata</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/common&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#9876aa">TYPEORM_EX_CUSTOM_REPOSITORY</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&quot;TYPEORM_EX_CUSTOM_REPOSITORY&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">CustomRepository</span><span class="token" style="color:#a9b7c6">(</span><span>entity</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Function</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">ClassDecorator</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">SetMetadata</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#9876aa">TYPEORM_EX_CUSTOM_REPOSITORY</span><span class="token" style="color:#a9b7c6">,</span><span> entity</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span></span><span class="token" style="color:#808080">// typeorm-ex.module.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">DynamicModule</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Provider</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/common&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> getDataSourceToken </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/typeorm&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">DataSource</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;typeorm&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span> </span><span class="token" style="color:#9876aa">TYPEORM_EX_CUSTOM_REPOSITORY</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./typeorm-ex.decorator&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">class</span><span> </span><span class="token class-name maybe-class-name">TypeOrmExModule</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">public</span><span> </span><span class="token" style="color:#cc7832">static</span><span> forCustomRepository</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#9876aa">T</span><span> </span><span class="token" style="color:#cc7832">extends</span><span> </span><span class="token class-name" style="color:#cc7832">new</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token spread" style="color:#a9b7c6">...</span><span>args</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">any</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#e8bf6a">any</span><span class="token" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>    repositories</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#9876aa">T</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">DynamicModule</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">const</span><span> providers</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">Provider</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#cc7832">for</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">const</span><span> repository </span><span class="token" style="color:#cc7832">of</span><span> repositories</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token" style="color:#cc7832">const</span><span> entity </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token known-class-name class-name">Reflect</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">getMetadata</span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>        </span><span class="token" style="color:#9876aa">TYPEORM_EX_CUSTOM_REPOSITORY</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>        repository</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>      </span><span class="token control-flow" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">!</span><span>entity</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        </span><span class="token control-flow" style="color:#cc7832">continue</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>      providers</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">push</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        inject</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#ffc66d">getDataSourceToken</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>        provide</span><span class="token" style="color:#a9b7c6">:</span><span> repository</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>        useFactory</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>dataSource</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">DataSource</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">typeof</span><span> repository </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>          </span><span class="token" style="color:#cc7832">const</span><span> baseRepository </span><span class="token" style="color:#a9b7c6">=</span><span> dataSource</span><span class="token" style="color:#a9b7c6">.</span><span class="token generic-function" style="color:#ffc66d">getRepository</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name" style="color:#e8bf6a">any</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span>entity</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>          </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#cc7832">new</span><span> </span><span class="token class-name">repository</span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>            baseRepository</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">target</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>            baseRepository</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">manager</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>            baseRepository</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">queryRunner</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>          </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      exports</span><span class="token" style="color:#a9b7c6">:</span><span> providers</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      module</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">TypeOrmExModule</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      providers</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></pre></pre>
<h2>사용할 repository 생성</h2>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-typescript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// src/postlist/repository/postlist.repository.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">CustomRepository</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;src/database/typeorm-ex.decorator&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Repository</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;typeorm&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Postlist</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;../entities/postlist.entity&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">CustomRepository</span><span class="token" style="color:#a9b7c6">(</span><span class="token maybe-class-name">Postlist</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">class</span><span> </span><span class="token class-name maybe-class-name">PostlistRepository</span><span> </span><span class="token" style="color:#cc7832">extends</span><span> </span><span class="token class-name maybe-class-name">Repository</span><span class="token class-name" style="color:#a9b7c6">&lt;</span><span class="token class-name maybe-class-name">Postlist</span><span class="token class-name" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span></code></pre></pre>
<h2>module에 생성한 repository import</h2>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-typescript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// src/postlist/postlist.module.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Module</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/common&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PostlistController</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./postlist.controller&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PostlistService</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./postlist.service&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PostlistRepository</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./repository/postlist.repository&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">TypeOrmExModule</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;src/database/typeorm-ex.module&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Module</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  imports</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token maybe-class-name">TypeOrmExModule</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">forCustomRepository</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">[</span><span class="token maybe-class-name">PostlistRepository</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  controllers</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token maybe-class-name">PostlistController</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  providers</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token maybe-class-name">PostlistService</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">class</span><span> </span><span class="token class-name maybe-class-name">PostlistModule</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span></code></pre></pre>
<h3>Module에 import 후 service 비즈니스 로직에만 repository를 넣어주면 된다.</h3>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-typescript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// src/postlist/postlist.service.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Injectable</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">NotFoundException</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/common&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">UpdatePostDto</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./dto/update-postlist.dto&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PostlistRepository</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./repository/postlist.repository&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Postlist</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./entities/postlist.entity&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">CreatePostDto</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./dto/create-postlist.dto&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Injectable</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">class</span><span> </span><span class="token class-name maybe-class-name">PostlistService</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#ffc66d">constructor</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">private</span><span> </span><span class="token" style="color:#cc7832">readonly</span><span> postlistRepository</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">PostlistRepository</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token" style="color:#cc7832">async</span><span> </span><span class="token" style="color:#ffc66d">getAllPost</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Promise</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">Postlist</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">const</span><span> found </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token control-flow" style="color:#cc7832">await</span><span> </span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">postlistRepository</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">find</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> found</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token" style="color:#cc7832">async</span><span> </span><span class="token" style="color:#ffc66d">getPostById</span><span class="token" style="color:#a9b7c6">(</span><span>id</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Promise</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">Postlist</span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">const</span><span> found </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token control-flow" style="color:#cc7832">await</span><span> </span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">postlistRepository</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">findOne</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span> where</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span> id</span><span class="token" style="color:#a9b7c6">:</span><span> id </span><span class="token" style="color:#a9b7c6">}</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">!</span><span>found</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#cc7832">throw</span><span> </span><span class="token" style="color:#cc7832">new</span><span> </span><span class="token class-name maybe-class-name">NotFoundException</span><span class="token" style="color:#a9b7c6">(</span><span class="token template-string template-punctuation" style="color:#6a8759">`</span><span class="token template-string" style="color:#6a8759">Cannot find post with id </span><span class="token template-string interpolation interpolation-punctuation" style="color:#a9b7c6">${</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation" style="color:#a9b7c6">}</span><span class="token template-string template-punctuation" style="color:#6a8759">`</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> found</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span></span><span class="token" style="color:#808080">// src/postlist/postlist.controller.ts</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Body</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Controller</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Get</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Param</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Patch</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Post</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/common&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">CreatePostDto</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./dto/create-postlist.dto&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PostlistService</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./postlist.service&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">UpdatePostDto</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./dto/update-postlist.dto&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Delete</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;@nestjs/common/decorators&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Postlist</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./entities/postlist.entity&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Controller</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;postlist&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">class</span><span> </span><span class="token class-name maybe-class-name">PostlistController</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#ffc66d">constructor</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">readonly</span><span> postlistService</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">PostlistService</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Post</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#ffc66d">createOne</span><span class="token" style="color:#a9b7c6">(</span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Body</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> createPostDto</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">CreatePostDto</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Promise</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">Postlist</span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">postlistService</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">createPost</span><span class="token" style="color:#a9b7c6">(</span><span>createPostDto</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Get</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#ffc66d">getAll</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Promise</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">Postlist</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">postlistService</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">getAllPost</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Get</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;:id&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#ffc66d">getOne</span><span class="token" style="color:#a9b7c6">(</span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Param</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;id&quot;</span><span class="token" style="color:#a9b7c6">)</span><span> id</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Promise</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">Postlist</span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">postlistService</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">getPostById</span><span class="token" style="color:#a9b7c6">(</span><span>id</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Patch</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;:id&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#ffc66d">updateOne</span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>    </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Param</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;id&quot;</span><span class="token" style="color:#a9b7c6">)</span><span> id</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>    </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Body</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> updateData</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">UpdatePostDto</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Promise</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">Postlist</span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">postlistService</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">updatePost</span><span class="token" style="color:#a9b7c6">(</span><span>id</span><span class="token" style="color:#a9b7c6">,</span><span> updateData</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Delete</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;:id&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#ffc66d">deleteOne</span><span class="token" style="color:#a9b7c6">(</span><span class="token decorator at" style="color:#a9b7c6">@</span><span class="token decorator" style="color:#ffc66d">Param</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;id&quot;</span><span class="token" style="color:#a9b7c6">)</span><span> id</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token known-class-name class-name">Promise</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#cc7832">void</span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">postlistService</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">deletePost</span><span class="token" style="color:#a9b7c6">(</span><span>id</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></pre></pre>
<p>필요한 로직을 설정한 후 postman을 작동시켜주면 정상적으로 실행되는 것을 볼 수 있다.</p>
<p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbMxspb%2FbtrUIZG6vWP%2F0dVetFuaUfkfuI9EXCKeN0%2Fimg.png" alt="image"/></p>
<p>nextjs와 동시에 작업하기 위해 nestjs 포트를 3001로 설정했지만, 보통은 nest 설치 시 app에 3000으로 설정된다.</p>
<p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcOfHG5%2FbtrUOQBYHjX%2FoGOqOJtiF2KbPiyKu9JCdK%2Fimg.png" alt="image"/></p>
<p>DB는 postgreSQL을 이용했다.
정상적으로 테이블에 있는 데이터가 추출되는 것이 잘 확인된다.</p>
<h3>참고 :</h3>
<p><a href="https://orkhan.gitbook.io/typeorm/readme_ko">https://orkhan.gitbook.io/typeorm/readme_ko</a></p>
<p><a href="https://docs.nestjs.com/techniques/database">https://docs.nestjs.com/techniques/database</a></p></div></main><div class="sc-b56d1f4e-0 btKgLL"><p><strong>&quot;nestjs&quot;</strong> <!-- -->카테고리의 다른 글</p><ul class="sc-b56d1f4e-1 isPGIu"></ul></div><div class="sc-11af7490-3 hHZXdG"><p>COMMENTS</p><section id="comment-box"></section></div></main></article><aside class="sc-a8eb4d0-0 hPXHcC"><nav class="sc-4a95414f-0 lfKWEG"><ul class="sc-4a95414f-1 dWXXgn"><li>Category</li><li class="sc-4a95414f-2 qcuRA"><a href="/blog">Simple Memo</a></li><li class="sc-4a95414f-2 qcuRA"><a href="/html">HTML</a></li><li class="sc-4a95414f-2 qcuRA"><a href="/css">CSS</a></li><li class="sc-4a95414f-2 qcuRA"><a href="/javascript">JavaScript</a></li><li class="sc-4a95414f-2 qcuRA"><a href="/typescript">TypeScript</a></li><li class="sc-4a95414f-2 qcuRA"><a href="/redux">Redux</a></li><li class="sc-4a95414f-2 qcuRA"><a href="/react">React</a></li><li class="sc-4a95414f-2 qcuRA"><a href="/nextjs">Nextjs</a></li><li style="color:white;font-weight:bold" class="sc-4a95414f-2 qcuRA"><a href="/nestjs">Nestjs</a></li></ul></nav></aside></section></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"nestjs custom repository","description":"Entityrepository()를 대신한 Repository 생성","category":"nestjs","date":"2023-03-04","content":"\r\n## 포스팅 시점 nestjs 버전 : 9.x.x\r\n\r\n새로운 토이 프로젝트를 만들면서 백엔드를 구축할 프레임워크로 nestjs를 이용하기로 마음먹었다.\r\n\r\n원래 사용하고 있던 javascript/typescript와 동일한 언어를 사용하기 때문에 백엔드 구축에 비교적 진입장벽이 낮다고 생각했기 때문에다.\r\n\r\n# nest 작동순서\r\n\r\nrequest -\u003e controller -\u003e service -\u003e controller -\u003e response 순으로 작동하나, DB와 관련된 일을 시키기 위해서는 repository를 생성해야한다고 한다. 즉,\r\n\r\nrequest -\u003e controller -\u003e service -\u003e repo\\* -\u003e service -\u003e controller -\u003e response\r\n로 한 단계가 추가된다. (Repostitory pattern)\r\n\r\n@EntityRepository를 통해 레포지토리를 설정해주는 방식이 많이 보였지만\r\n\r\n![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2\u0026fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FlkldE%2FbtrUQbTjKZA%2FA6hFzyRy8SsueBbUk8cTA1%2Fimg.png)\r\n\r\n현재 버전에서는 사용할 수 없어 다른 방법을 알아봤다.\r\n\r\n## 기본 설정\r\n\r\nconfig 설정\r\n\r\n```typescript\r\n// src/configs/typeorm.configs.ts\r\n\r\nexport const typeORMConfig: TypeOrmModuleOptions = {\r\n  // Database Type\r\n  type: \"postgres\", // 본인은 pg를 사용\r\n  host: \"localhost\",\r\n  port: 5432,\r\n  username: \"postgres\",\r\n  password: \"password\",\r\n  database: \"database\",\r\n  entities: [__dirname + \"/../**/*.entity.{js,ts}\"], // 해당 경로 + 엔티티이름.entity.{js.ts}로 된 엔티티를 이용\r\n  // autoLoadEntities: true, // 위와 다르게 entity들 알아서 찾아줌\r\n  synchronize: true, // @@@@@@@@ 배포할때 true 사용 시 데이터 삭제될 수 있음. production 단계에서는 필히 false로 해줄 것 권장 @@@@@@\r\n};\r\n```\r\n\r\nconfig 설정 후 root 모듈에 import\r\n\r\n```typescript\r\n// app.module.ts\r\n\r\nimport { Module } from \"@nestjs/common\";\r\nimport { AppController } from \"./app.controller\";\r\nimport { PostlistModule } from \"./postlist/postlist.module\";\r\nimport { typeORMConfig } from \"./configs/typeorm.configs\";\r\nimport { TypeOrmModule } from \"@nestjs/typeorm/dist\";\r\n\r\n@Module({\r\n  imports: [TypeOrmModule.forRoot(typeORMConfig), PostlistModule],\r\n  controllers: [AppController],\r\n  providers: [],\r\n})\r\nexport class AppModule {}\r\n```\r\n\r\nentity 생성\r\n\r\n```typescript\r\n// src/postlist/entities/postlist.entity.ts\r\n\r\nimport { BaseEntity, Column, PrimaryGeneratedColumn, Entity } from \"typeorm\";\r\n\r\n@Entity()\r\nexport class Postlist extends BaseEntity {\r\n  @PrimaryGeneratedColumn()\r\n  id: number;\r\n\r\n  @Column()\r\n  title: string;\r\n\r\n  @Column()\r\n  content: string;\r\n\r\n  @Column()\r\n  nickname: string;\r\n\r\n  @Column()\r\n  imageUrl?: string;\r\n}\r\n```\r\n\r\n\u003e config 설정 시 entities에 이름을 ~~.entity.{js.ts} 로 설정해놓고, 정작 entity 파일 이름을 설정한 형식과 다르게 작성하면 [EntityMetadataNotFound] 에러를 띄우게 되기 때문에 설정한대로 이름을 지어줘야 한다.\r\n\r\n참조 : https://github.com/typeorm/typeorm/issues/1327\r\n\r\n## custumRepository 만들기\r\n\r\n본인은 src에 database 디렉토리를 만들어, 데코레이터와 모듈을 그 안에 넣어줬다.\r\n\r\n```typescript\r\n// src/database/typeorm-ex.decorator.ts\r\n\r\nimport { SetMetadata } from \"@nestjs/common\";\r\n\r\nexport const TYPEORM_EX_CUSTOM_REPOSITORY = \"TYPEORM_EX_CUSTOM_REPOSITORY\";\r\n\r\nexport function CustomRepository(entity: Function): ClassDecorator {\r\n  return SetMetadata(TYPEORM_EX_CUSTOM_REPOSITORY, entity);\r\n}\r\n\r\n// typeorm-ex.module.ts\r\n\r\nimport { DynamicModule, Provider } from \"@nestjs/common\";\r\nimport { getDataSourceToken } from \"@nestjs/typeorm\";\r\nimport { DataSource } from \"typeorm\";\r\nimport { TYPEORM_EX_CUSTOM_REPOSITORY } from \"./typeorm-ex.decorator\";\r\n\r\nexport class TypeOrmExModule {\r\n  public static forCustomRepository\u003cT extends new (...args: any[]) =\u003e any\u003e(\r\n    repositories: T[],\r\n  ): DynamicModule {\r\n    const providers: Provider[] = [];\r\n\r\n    for (const repository of repositories) {\r\n      const entity = Reflect.getMetadata(\r\n        TYPEORM_EX_CUSTOM_REPOSITORY,\r\n        repository,\r\n      );\r\n\r\n      if (!entity) {\r\n        continue;\r\n      }\r\n\r\n      providers.push({\r\n        inject: [getDataSourceToken()],\r\n        provide: repository,\r\n        useFactory: (dataSource: DataSource): typeof repository =\u003e {\r\n          const baseRepository = dataSource.getRepository\u003cany\u003e(entity);\r\n          return new repository(\r\n            baseRepository.target,\r\n            baseRepository.manager,\r\n            baseRepository.queryRunner,\r\n          );\r\n        },\r\n      });\r\n    }\r\n\r\n    return {\r\n      exports: providers,\r\n      module: TypeOrmExModule,\r\n      providers,\r\n    };\r\n  }\r\n}\r\n```\r\n\r\n## 사용할 repository 생성\r\n\r\n```typescript\r\n// src/postlist/repository/postlist.repository.ts\r\n\r\nimport { CustomRepository } from \"src/database/typeorm-ex.decorator\";\r\nimport { Repository } from \"typeorm\";\r\nimport { Postlist } from \"../entities/postlist.entity\";\r\n\r\n@CustomRepository(Postlist)\r\nexport class PostlistRepository extends Repository\u003cPostlist\u003e {}\r\n```\r\n\r\n## module에 생성한 repository import\r\n\r\n```typescript\r\n// src/postlist/postlist.module.ts\r\n\r\nimport { Module } from \"@nestjs/common\";\r\nimport { PostlistController } from \"./postlist.controller\";\r\nimport { PostlistService } from \"./postlist.service\";\r\nimport { PostlistRepository } from \"./repository/postlist.repository\";\r\nimport { TypeOrmExModule } from \"src/database/typeorm-ex.module\";\r\n\r\n@Module({\r\n  imports: [TypeOrmExModule.forCustomRepository([PostlistRepository])],\r\n  controllers: [PostlistController],\r\n  providers: [PostlistService],\r\n})\r\nexport class PostlistModule {}\r\n```\r\n\r\n### Module에 import 후 service 비즈니스 로직에만 repository를 넣어주면 된다.\r\n\r\n```typescript\r\n// src/postlist/postlist.service.ts\r\n\r\nimport { Injectable, NotFoundException } from \"@nestjs/common\";\r\nimport { UpdatePostDto } from \"./dto/update-postlist.dto\";\r\n\r\nimport { PostlistRepository } from \"./repository/postlist.repository\";\r\nimport { Postlist } from \"./entities/postlist.entity\";\r\nimport { CreatePostDto } from \"./dto/create-postlist.dto\";\r\n\r\n@Injectable()\r\nexport class PostlistService {\r\n  constructor(private readonly postlistRepository: PostlistRepository) {}\r\n\r\n  async getAllPost(): Promise\u003cPostlist[]\u003e {\r\n    const found = await this.postlistRepository.find();\r\n    return found;\r\n  }\r\n\r\n  async getPostById(id: number): Promise\u003cPostlist\u003e {\r\n    const found = await this.postlistRepository.findOne({ where: { id: id } });\r\n    if (!found) {\r\n      throw new NotFoundException(`Cannot find post with id ${id}`);\r\n    }\r\n    return found;\r\n  }\r\n}\r\n\r\n// src/postlist/postlist.controller.ts\r\n\r\nimport { Body, Controller, Get, Param, Patch, Post } from \"@nestjs/common\";\r\nimport { CreatePostDto } from \"./dto/create-postlist.dto\";\r\nimport { PostlistService } from \"./postlist.service\";\r\nimport { UpdatePostDto } from \"./dto/update-postlist.dto\";\r\nimport { Delete } from \"@nestjs/common/decorators\";\r\nimport { Postlist } from \"./entities/postlist.entity\";\r\n\r\n@Controller(\"postlist\")\r\nexport class PostlistController {\r\n  constructor(readonly postlistService: PostlistService) {}\r\n\r\n  @Post()\r\n  createOne(@Body() createPostDto: CreatePostDto): Promise\u003cPostlist\u003e {\r\n    return this.postlistService.createPost(createPostDto);\r\n  }\r\n\r\n  @Get()\r\n  getAll(): Promise\u003cPostlist[]\u003e {\r\n    return this.postlistService.getAllPost();\r\n  }\r\n\r\n  @Get(\":id\")\r\n  getOne(@Param(\"id\") id: number): Promise\u003cPostlist\u003e {\r\n    return this.postlistService.getPostById(id);\r\n  }\r\n\r\n  @Patch(\":id\")\r\n  updateOne(\r\n    @Param(\"id\") id: number,\r\n    @Body() updateData: UpdatePostDto,\r\n  ): Promise\u003cPostlist\u003e {\r\n    return this.postlistService.updatePost(id, updateData);\r\n  }\r\n\r\n  @Delete(\":id\")\r\n  deleteOne(@Param(\"id\") id: number): Promise\u003cvoid\u003e {\r\n    return this.postlistService.deletePost(id);\r\n  }\r\n}\r\n```\r\n\r\n필요한 로직을 설정한 후 postman을 작동시켜주면 정상적으로 실행되는 것을 볼 수 있다.\r\n\r\n![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2\u0026fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbMxspb%2FbtrUIZG6vWP%2F0dVetFuaUfkfuI9EXCKeN0%2Fimg.png)\r\n\r\nnextjs와 동시에 작업하기 위해 nestjs 포트를 3001로 설정했지만, 보통은 nest 설치 시 app에 3000으로 설정된다.\r\n\r\n![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2\u0026fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcOfHG5%2FbtrUOQBYHjX%2FoGOqOJtiF2KbPiyKu9JCdK%2Fimg.png)\r\n\r\nDB는 postgreSQL을 이용했다.\r\n정상적으로 테이블에 있는 데이터가 추출되는 것이 잘 확인된다.\r\n\r\n### 참고 :\r\n\r\nhttps://orkhan.gitbook.io/typeorm/readme_ko\r\n\r\nhttps://docs.nestjs.com/techniques/database\r\n"},"__N_SSG":true},"page":"/nestjs/[slug]","query":{"slug":"nestjs-custom-repository"},"buildId":"9g1QMk00T1BReQcEHL4r_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>