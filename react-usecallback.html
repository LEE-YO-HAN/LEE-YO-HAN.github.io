<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>Rain Sugar BangBang Front-End</title><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="useCallback을 이용한 컴포넌트 최적화하기"/><meta name="keywords" content="react, react usecallback"/><meta http-equiv="title" content="useCallback을 이용한 컴포넌트 최적화하기"/><meta http-equiv="subject" content="react"/><meta property="og:title" content="react usecallback"/><meta property="og:description" content="useCallback을 이용한 컴포넌트 최적화하기"/><meta property="og:image" content="/images/cards/REACT.png"/><meta name="naver-site-verification" content="af9c8049662a7c6c85ea946e9eb561086e70062c"/><meta name="google-site-verification" content="Zgp7rA3RAdcRnhPPsGLK-t4KVTO86AejlDIQQIGpvLg"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4077287316160146" crossorigin="anonymous"></script><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="14"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/f9bc783e634631d2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f9bc783e634631d2.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7d0bddee48749f95.js" defer=""></script><script src="/_next/static/chunks/framework-73b8966a3c579ab0.js" defer=""></script><script src="/_next/static/chunks/main-b0c8bcfd40968c52.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e74bf16f11e69be.js" defer=""></script><script src="/_next/static/chunks/224-d3df8d854690f2a0.js" defer=""></script><script src="/_next/static/chunks/572-85f46fe0d367792d.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-1e53f6a91eb0ff2f.js" defer=""></script><script src="/_next/static/qAVY6dEa2fkI5k9enxOKQ/_buildManifest.js" defer=""></script><script src="/_next/static/qAVY6dEa2fkI5k9enxOKQ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="sc-c845a976-0 icUnkm"><header class="sc-4bf6e269-0 eOrcva"><h1><a href="/">Rain Sugar BangBang</a></h1></header><section class="sc-c845a976-1 bePtAz"><aside class="sc-8da54c0a-0 bjetgu"><div class="sc-8da54c0a-1 dIjcTQ"><a href="/profile"><img alt="profile" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" style="color:transparent" src="/images/profileImage/cat.png"/><span>Go Profile!</span></a><p>Hanbbi</p></div><div class="sc-8da54c0a-2 kCIPRs"><a target="_blank" href="https://github.com/LEE-YO-HAN"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg><span>yhl0078@gmail.com</span></a><a target="_blank" href="https://github.com/LEE-YO-HAN"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg><span>Github</span></a></div></aside><article class="sc-c845a976-2 jRRSKe"><main class="sc-e9ba6bf1-0 cAjCIB"><section class="sc-e9ba6bf1-1 eQOsDg"><p>react</p><h1>useCallback을 이용한 컴포넌트 최적화하기</h1><span>2023-03-16</span></section><main class="sc-e9ba6bf1-2 dkijLv"><div class="markdown"><h1>useCallback이란?</h1>
<blockquote>
<p>특정 함수를 새로 만들지 않고 재사용하고 싶을때 사용하는 함수 메모이제이션용 React hook이다.</p>
</blockquote>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-javascript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">const</span><span> memoFn </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#ffc66d">useCallback</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>dep</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span></code></pre></pre>
<p>첫번째 인자의 함수를 두번째 인자의 종속성 배열 내의 값이 변경될 때까지 저장하여 재사용할 수 있도록 해준다.</p>
<p>javascript에서 함수(function () {} or () =&gt; {})는 객체 리터럴( {...} )이 항상 새 객체를 생성하는 것과 유사하게 항상 다른 함수를 생성한다. 그렇다면 함수를 props 로 내려준다고 하면 하위 컴포넌트는 props가 변경되었다고 인식하게 된다.</p>
<p>그렇게되면 React.memo를 이용한 최적화가 원하는대로 작동하지 않을 수 있기 때문에 이러한 점을 useCallback이 메꿔줄 수 있게 된다.</p>
<blockquote>
<p>종속성 배열이 없는 경우 매번 새 함수를 반환하기 때문에 항상 dependencises 배열을 포함해줘야 한다. (특정 상황에서 빈 배열 [] 은 있을 수 있지만, 배열 자체가 없으면 의미가 없어진다.)</p>
</blockquote>
<h2>사용예</h2>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-javascript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">const</span><span> add </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#ffc66d">useCallback</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> x </span><span class="token" style="color:#a9b7c6">+</span><span> y</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span> y</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span></code></pre></pre>
<h1>useCallback과 React.memo를 통한 최적화</h1>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-javascript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// 최상단 (1번) 컴포넌트</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> useState </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;react&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">UseCallbackChildren</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./UseCallbackChildren&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token function-variable maybe-class-name" style="color:#ffc66d">UseCallbackTest</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>isDark</span><span class="token" style="color:#a9b7c6">,</span><span> setIsDark</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#ffc66d">useState</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">false</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span>input
</span><span>          type</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;checkbox&quot;</span><span>
</span><span>          checked</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span>isDark</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>          onChange</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span class="token parameter">e</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#ffc66d">setIsDark</span><span class="token" style="color:#a9b7c6">(</span><span>e</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">target</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">checked</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token maybe-class-name">Dark</span><span> mode
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>hr </span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">UseCallbackChildren</span><span>
</span><span>        productId</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#6897bb">123</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>        referrer</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;wizard_of_oz&quot;</span><span>
</span><span>        theme</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span>isDark </span><span class="token" style="color:#a9b7c6">?</span><span> </span><span class="token" style="color:#6a8759">&quot;dark&quot;</span><span> </span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;light&quot;</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token" style="color:#808080">// 중간 (2번) 컴포넌트</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports maybe-class-name">React</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> useCallback </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;react&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">CallbackForm</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;./UseCallbackForn&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token function-variable maybe-class-name" style="color:#ffc66d">UseCallbackChildren</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token parameter" style="color:#a9b7c6">{</span><span class="token parameter"> referrer</span><span class="token parameter" style="color:#a9b7c6">,</span><span class="token parameter"> productId</span><span class="token parameter" style="color:#a9b7c6">,</span><span class="token parameter"> theme </span><span class="token parameter" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token function-variable" style="color:#ffc66d">post</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token parameter">url</span><span class="token parameter" style="color:#a9b7c6">,</span><span class="token parameter"> data</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token console class-name">console</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">log</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;POST /&quot;</span><span> </span><span class="token" style="color:#a9b7c6">+</span><span> url</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token console class-name">console</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">log</span><span class="token" style="color:#a9b7c6">(</span><span>data</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#cc7832">const</span><span> handleSubmit </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#ffc66d">useCallback</span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>    </span><span class="token parameter">orderDetails</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token" style="color:#ffc66d">post</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;/product/&quot;</span><span> </span><span class="token" style="color:#a9b7c6">+</span><span> productId </span><span class="token" style="color:#a9b7c6">+</span><span> </span><span class="token" style="color:#6a8759">&quot;/buy&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        referrer</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>        orderDetails</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">[</span><span>productId</span><span class="token" style="color:#a9b7c6">,</span><span> referrer</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&lt;</span><span>div
</span><span>      style</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        theme </span><span class="token" style="color:#a9b7c6">===</span><span> </span><span class="token" style="color:#6a8759">&quot;dark&quot;</span><span> </span><span class="token" style="color:#a9b7c6">?</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span> </span><span class="token literal-property" style="color:#9876aa">backgroundColor</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;black&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token literal-property" style="color:#9876aa">color</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;white&quot;</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span> </span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token maybe-class-name">CallbackForm</span><span> onSubmit</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span>handleSubmit</span><span class="token" style="color:#a9b7c6">}</span><span> </span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>div</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token" style="color:#808080">// 하위 (3번) 컴포넌트</span><span>
</span><span></span><span class="token module" style="color:#cc7832">import</span><span> </span><span class="token imports maybe-class-name">React</span><span class="token imports" style="color:#a9b7c6">,</span><span class="token imports"> </span><span class="token imports" style="color:#a9b7c6">{</span><span class="token imports"> useState </span><span class="token imports" style="color:#a9b7c6">}</span><span> </span><span class="token module" style="color:#cc7832">from</span><span> </span><span class="token" style="color:#6a8759">&quot;react&quot;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token function-variable maybe-class-name" style="color:#ffc66d">UseCallbackForm</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token parameter" style="color:#a9b7c6">{</span><span class="token parameter"> onSubmit </span><span class="token parameter" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>count</span><span class="token" style="color:#a9b7c6">,</span><span> setCount</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#ffc66d">useState</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token console class-name">console</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">log</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;강제로 느리게&quot;</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">let</span><span> startTime </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token dom" style="color:#9876aa">performance</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">now</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">while</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token dom" style="color:#9876aa">performance</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">now</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span> startTime </span><span class="token" style="color:#a9b7c6">&lt;</span><span> </span><span class="token" style="color:#6897bb">500</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// Do nothing for 500 ms to emulate extremely slow code</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token function-variable" style="color:#ffc66d">handleSubmit</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token parameter">e</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    e</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">preventDefault</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">const</span><span> formData </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#cc7832">new</span><span> </span><span class="token class-name">FormData</span><span class="token" style="color:#a9b7c6">(</span><span>e</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">target</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">const</span><span> orderDetails </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token spread" style="color:#a9b7c6">...</span><span class="token known-class-name class-name">Object</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">fromEntries</span><span class="token" style="color:#a9b7c6">(</span><span>formData</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      count</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token" style="color:#ffc66d">onSubmit</span><span class="token" style="color:#a9b7c6">(</span><span>orderDetails</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&lt;</span><span>form
</span><span>      onSubmit</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span>handleSubmit</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>      style</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">{</span><span> </span><span class="token literal-property" style="color:#9876aa">display</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;flex&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token literal-property" style="color:#9876aa">flexDirection</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;column&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token literal-property" style="color:#9876aa">width</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&quot;200px&quot;</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>p</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span>b</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>          </span><span class="token literal-property" style="color:#9876aa">Note</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">&lt;</span><span>code</span><span class="token" style="color:#a9b7c6">&gt;</span><span class="token maybe-class-name">ShippingForm</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>code</span><span class="token" style="color:#a9b7c6">&gt;</span><span> is artificially slowed down</span><span class="token" style="color:#a9b7c6">!</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>b</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>p</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token known-class-name class-name">Number</span><span> </span><span class="token" style="color:#cc7832">of</span><span> </span><span class="token literal-property" style="color:#9876aa">items</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span>button type</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;button&quot;</span><span> onClick</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#ffc66d">setCount</span><span class="token" style="color:#a9b7c6">(</span><span>count </span><span class="token" style="color:#a9b7c6">-</span><span> </span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>          </span><span class="token" style="color:#a9b7c6">-</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>button</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">{</span><span>count</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span>button type</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;button&quot;</span><span> onClick</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#ffc66d">setCount</span><span class="token" style="color:#a9b7c6">(</span><span>count </span><span class="token" style="color:#a9b7c6">+</span><span> </span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>          </span><span class="token" style="color:#a9b7c6">+</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>button</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token literal-property" style="color:#9876aa">Street</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span>input name</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;street&quot;</span><span> </span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token literal-property" style="color:#9876aa">City</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span>input name</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;city&quot;</span><span> </span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>        </span><span class="token maybe-class-name">Postal</span><span> code</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">&lt;</span><span>input name</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;zipCode&quot;</span><span> </span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>label</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">&lt;</span><span>button type</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;submit&quot;</span><span class="token" style="color:#a9b7c6">&gt;</span><span class="token maybe-class-name">Submit</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>button</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span><span>form</span><span class="token" style="color:#a9b7c6">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span></span><span class="token module" style="color:#cc7832">export</span><span> </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token maybe-class-name">CallbackForm</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token maybe-class-name">React</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">memo</span><span class="token" style="color:#a9b7c6">(</span><span class="token maybe-class-name">UseCallbackForm</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span></code></pre></pre>
<p>위 코드를 보면, 최상단(1)에 있는 다크모드는 중간(2) 컴포넌트까지만 전달해주고, 중간(2) 컴포넌트는 하위(3) 컴포넌트에 useCallback 함수만 전달해주고 있다.</p>
<p>useCallback은 함수를 캐시해 재사용할 수 있도록 도와주기 때문에 종속성이 변하지 않으면 계속 재사용할 수 있다. 즉, 동일한 props로써 함수를 하위(3) 컴포넌트에 내려주고 있기 때문에 하위 컴포넌트의 렌더링에 영향이 없다.</p>
<p>이 상태로 코드를 작동시키면 하위(3) 컴포넌트에 있는 count를 동작할때마다 느려지겠지만, 다크모드와 submit 이벤트에는 영향을 주지 않는다.</p>
<p><img src="https://blog.kakaocdn.net/dn/bEYsKw/btr4gSLc8BG/hJKpnBKbFziku3fjI6hphK/img.gif" alt="image"/></p>
<p>만약 하위(3) 컴포넌트의 React.memo()를 없애게 되면 submit 이벤트에는 영향이 없지만, 최상위(1) 컴포넌트의 다크모드 state 변경에 의해 하위(3) 컴포넌트의 렌더링이 일어나게 되어 다크모드와 count의 동작이 느려지는걸 볼 수 있다.</p>
<p><img src="https://blog.kakaocdn.net/dn/mfxA0/btr4iTijPZD/XNzKmFrScoUZ6qSyiCMV2K/img.gif" alt="image"/></p>
<p>자세히 보면 콘솔이 먼저 찍히고 0.5초정도 뒤에 동작하는 것을 볼 수 있다.</p>
<h1>useMemo와의 차이점</h1>
<blockquote>
<p>useMemo는 함수의 호출 결과를 캐시하고, useCallback은 함수 자체는 캐시한다. 그러므로 useCallback은 useMemo와 달리 제공한 함수를 호출하지 않는다. 대신 사용자가 제공한 함수를 캐시하기 때문에 불필요한 렌더링 없이 함수를 전달할 수 있다.</p>
</blockquote>
<h2>useMemo와 useCallback의 동시 사용</h2>
<pre><pre node="[object Object]" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-javascript" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token" style="color:#ffc66d">useCallback</span><span class="token" style="color:#a9b7c6">(</span><span class="token parameter">fn</span><span class="token parameter" style="color:#a9b7c6">,</span><span class="token parameter"> dependencies</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#ffc66d">useMemo</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> fn</span><span class="token" style="color:#a9b7c6">,</span><span> dependencies</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></pre></pre>
<h2>useCallback이 유용한 경우</h2>
<ul>
<li>useCallback을 통해 props로 하위 컴포넌트에 넘겨줄때</li>
<li>useEffect 등 다른 hook의 종속성으로 이용할때</li>
<li>종속성 변화가 적고 재사용이 용이할때</li>
</ul>
<h2>useCallback 남용 시 문제점</h2>
<blockquote>
<p>모든 함수를 useCallback으로 감싸게 되면 컴포넌트가 리렌더 될 때마다 모든 함수가 다시 재생성될 필요가 있는지 검사하는 연산이 수행된다. 따라서 보통은 특정 함수가 props로 전달되어 불필요한 컴포넌트 리렌더를 유발할 때에만 적용하는 것이 좋다.</p>
</blockquote>
<h3>memo, useMemo, useCallback 등 어떤 Memoization이나 부적절하게 사용할 경우 오히려 성능이 떨어질 수 있기 때문에 상황에 맞게 적절하게 사용하는 것이 좋은 것 같다.</h3>
<hr/>
<p>참조: <a href="https://beta.reactjs.org/reference/react/useCallback">https://beta.reactjs.org/reference/react/useCallback</a></p></div></main><div class="sc-5d85fe2b-0 hZKBvj"><p><strong>&quot;react&quot;</strong> <!-- -->카테고리의 다른 글</p><ul class="sc-5d85fe2b-1 iBEUbA"></ul></div><div class="sc-e9ba6bf1-3 iviOZH"><p>COMMENTS</p><section id="comment-box"></section></div></main></article><aside class="sc-25c0fcf1-0 hVEAVi"><nav class="sc-cd9d196f-0 eIKFyK"><ul class="sc-cd9d196f-1 ljGEKP"><li>Category</li><li class="sc-cd9d196f-2 itBJIo"><a href="/github">Simple Memo</a></li><li class="sc-cd9d196f-2 itBJIo"><a href="/html">HTML</a></li><li class="sc-cd9d196f-2 itBJIo"><a href="/css">CSS</a></li><li class="sc-cd9d196f-2 itBJIo"><a href="/javascript">JavaScript</a></li><li class="sc-cd9d196f-2 itBJIo"><a href="/typescript">TypeScript</a></li><li class="sc-cd9d196f-2 itBJIo"><a href="/redux">Redux</a></li><li class="sc-cd9d196f-2 itBJIo"><a style="color:white;font-weight:bold" href="/react">React</a></li><li class="sc-cd9d196f-2 itBJIo"><a href="/nextjs">Nextjs</a></li><li class="sc-cd9d196f-2 itBJIo"><a href="/nestjs">Nestjs</a></li></ul></nav></aside></section></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"react usecallback","description":"useCallback을 이용한 컴포넌트 최적화하기","category":"react","date":"2023-03-16","content":"\r\n# useCallback이란?\r\n\r\n\u003e 특정 함수를 새로 만들지 않고 재사용하고 싶을때 사용하는 함수 메모이제이션용 React hook이다.\r\n\r\n```javascript\r\nconst memoFn = useCallback(() =\u003e {}, [dep]);\r\n```\r\n\r\n첫번째 인자의 함수를 두번째 인자의 종속성 배열 내의 값이 변경될 때까지 저장하여 재사용할 수 있도록 해준다.\r\n\r\njavascript에서 함수(function () {} or () =\u003e {})는 객체 리터럴( {...} )이 항상 새 객체를 생성하는 것과 유사하게 항상 다른 함수를 생성한다. 그렇다면 함수를 props 로 내려준다고 하면 하위 컴포넌트는 props가 변경되었다고 인식하게 된다.\r\n\r\n그렇게되면 React.memo를 이용한 최적화가 원하는대로 작동하지 않을 수 있기 때문에 이러한 점을 useCallback이 메꿔줄 수 있게 된다.\r\n\r\n\u003e 종속성 배열이 없는 경우 매번 새 함수를 반환하기 때문에 항상 dependencises 배열을 포함해줘야 한다. (특정 상황에서 빈 배열 [] 은 있을 수 있지만, 배열 자체가 없으면 의미가 없어진다.)\r\n\r\n## 사용예\r\n\r\n```javascript\r\nconst add = useCallback(() =\u003e x + y, [x, y]);\r\n```\r\n\r\n# useCallback과 React.memo를 통한 최적화\r\n\r\n```javascript\r\n// 최상단 (1번) 컴포넌트\r\nimport { useState } from \"react\";\r\nimport { UseCallbackChildren } from \"./UseCallbackChildren\";\r\n\r\nexport const UseCallbackTest = () =\u003e {\r\n  const [isDark, setIsDark] = useState(false);\r\n  return (\r\n    \u003c\u003e\r\n      \u003clabel\u003e\r\n        \u003cinput\r\n          type=\"checkbox\"\r\n          checked={isDark}\r\n          onChange={e =\u003e setIsDark(e.target.checked)}\r\n        /\u003e\r\n        Dark mode\r\n      \u003c/label\u003e\r\n      \u003chr /\u003e\r\n      \u003cUseCallbackChildren\r\n        productId={123}\r\n        referrer=\"wizard_of_oz\"\r\n        theme={isDark ? \"dark\" : \"light\"}\r\n      /\u003e\r\n    \u003c/\u003e\r\n  );\r\n};\r\n\r\n// 중간 (2번) 컴포넌트\r\nimport React, { useCallback } from \"react\";\r\nimport { CallbackForm } from \"./UseCallbackForn\";\r\n\r\nexport const UseCallbackChildren = ({ referrer, productId, theme }) =\u003e {\r\n  const post = (url, data) =\u003e {\r\n    console.log(\"POST /\" + url);\r\n    console.log(data);\r\n  };\r\n\r\n  const handleSubmit = useCallback(\r\n    orderDetails =\u003e {\r\n      post(\"/product/\" + productId + \"/buy\", {\r\n        referrer,\r\n        orderDetails,\r\n      });\r\n    },\r\n    [productId, referrer],\r\n  );\r\n\r\n  return (\r\n    \u003cdiv\r\n      style={\r\n        theme === \"dark\" ? { backgroundColor: \"black\", color: \"white\" } : {}\r\n      }\r\n    \u003e\r\n      \u003cCallbackForm onSubmit={handleSubmit} /\u003e\r\n    \u003c/div\u003e\r\n  );\r\n};\r\n\r\n// 하위 (3번) 컴포넌트\r\nimport React, { useState } from \"react\";\r\n\r\nexport const UseCallbackForm = ({ onSubmit }) =\u003e {\r\n  const [count, setCount] = useState(1);\r\n\r\n  console.log(\"강제로 느리게\");\r\n  let startTime = performance.now();\r\n  while (performance.now() - startTime \u003c 500) {\r\n    // Do nothing for 500 ms to emulate extremely slow code\r\n  }\r\n\r\n  const handleSubmit = e =\u003e {\r\n    e.preventDefault();\r\n    const formData = new FormData(e.target);\r\n    const orderDetails = {\r\n      ...Object.fromEntries(formData),\r\n      count,\r\n    };\r\n    onSubmit(orderDetails);\r\n  };\r\n\r\n  return (\r\n    \u003cform\r\n      onSubmit={handleSubmit}\r\n      style={{ display: \"flex\", flexDirection: \"column\", width: \"200px\" }}\r\n    \u003e\r\n      \u003cp\u003e\r\n        \u003cb\u003e\r\n          Note: \u003ccode\u003eShippingForm\u003c/code\u003e is artificially slowed down!\r\n        \u003c/b\u003e\r\n      \u003c/p\u003e\r\n      \u003clabel\u003e\r\n        Number of items:\r\n        \u003cbutton type=\"button\" onClick={() =\u003e setCount(count - 1)}\u003e\r\n          -\r\n        \u003c/button\u003e\r\n        {count}\r\n        \u003cbutton type=\"button\" onClick={() =\u003e setCount(count + 1)}\u003e\r\n          +\r\n        \u003c/button\u003e\r\n      \u003c/label\u003e\r\n      \u003clabel\u003e\r\n        Street:\r\n        \u003cinput name=\"street\" /\u003e\r\n      \u003c/label\u003e\r\n      \u003clabel\u003e\r\n        City:\r\n        \u003cinput name=\"city\" /\u003e\r\n      \u003c/label\u003e\r\n      \u003clabel\u003e\r\n        Postal code:\r\n        \u003cinput name=\"zipCode\" /\u003e\r\n      \u003c/label\u003e\r\n      \u003cbutton type=\"submit\"\u003eSubmit\u003c/button\u003e\r\n    \u003c/form\u003e\r\n  );\r\n};\r\n\r\nexport const CallbackForm = React.memo(UseCallbackForm);\r\n```\r\n\r\n위 코드를 보면, 최상단(1)에 있는 다크모드는 중간(2) 컴포넌트까지만 전달해주고, 중간(2) 컴포넌트는 하위(3) 컴포넌트에 useCallback 함수만 전달해주고 있다.\r\n\r\nuseCallback은 함수를 캐시해 재사용할 수 있도록 도와주기 때문에 종속성이 변하지 않으면 계속 재사용할 수 있다. 즉, 동일한 props로써 함수를 하위(3) 컴포넌트에 내려주고 있기 때문에 하위 컴포넌트의 렌더링에 영향이 없다.\r\n\r\n이 상태로 코드를 작동시키면 하위(3) 컴포넌트에 있는 count를 동작할때마다 느려지겠지만, 다크모드와 submit 이벤트에는 영향을 주지 않는다.\r\n\r\n![image](https://blog.kakaocdn.net/dn/bEYsKw/btr4gSLc8BG/hJKpnBKbFziku3fjI6hphK/img.gif)\r\n\r\n만약 하위(3) 컴포넌트의 React.memo()를 없애게 되면 submit 이벤트에는 영향이 없지만, 최상위(1) 컴포넌트의 다크모드 state 변경에 의해 하위(3) 컴포넌트의 렌더링이 일어나게 되어 다크모드와 count의 동작이 느려지는걸 볼 수 있다.\r\n\r\n![image](https://blog.kakaocdn.net/dn/mfxA0/btr4iTijPZD/XNzKmFrScoUZ6qSyiCMV2K/img.gif)\r\n\r\n자세히 보면 콘솔이 먼저 찍히고 0.5초정도 뒤에 동작하는 것을 볼 수 있다.\r\n\r\n# useMemo와의 차이점\r\n\r\n\u003e useMemo는 함수의 호출 결과를 캐시하고, useCallback은 함수 자체는 캐시한다. 그러므로 useCallback은 useMemo와 달리 제공한 함수를 호출하지 않는다. 대신 사용자가 제공한 함수를 캐시하기 때문에 불필요한 렌더링 없이 함수를 전달할 수 있다.\r\n\r\n## useMemo와 useCallback의 동시 사용\r\n\r\n```javascript\r\nfunction useCallback(fn, dependencies) {\r\n  return useMemo(() =\u003e fn, dependencies);\r\n}\r\n```\r\n\r\n## useCallback이 유용한 경우\r\n\r\n- useCallback을 통해 props로 하위 컴포넌트에 넘겨줄때\r\n- useEffect 등 다른 hook의 종속성으로 이용할때\r\n- 종속성 변화가 적고 재사용이 용이할때\r\n\r\n## useCallback 남용 시 문제점\r\n\r\n\u003e 모든 함수를 useCallback으로 감싸게 되면 컴포넌트가 리렌더 될 때마다 모든 함수가 다시 재생성될 필요가 있는지 검사하는 연산이 수행된다. 따라서 보통은 특정 함수가 props로 전달되어 불필요한 컴포넌트 리렌더를 유발할 때에만 적용하는 것이 좋다.\r\n\r\n### memo, useMemo, useCallback 등 어떤 Memoization이나 부적절하게 사용할 경우 오히려 성능이 떨어질 수 있기 때문에 상황에 맞게 적절하게 사용하는 것이 좋은 것 같다.\r\n\r\n---\r\n\r\n참조: https://beta.reactjs.org/reference/react/useCallback\r\n"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"react-usecallback"},"buildId":"qAVY6dEa2fkI5k9enxOKQ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>